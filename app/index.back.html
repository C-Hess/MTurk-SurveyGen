<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="css/mturk-manage.css">
    </head>
    <body id="root">
        <nav class="navbar navbar-expand-sm navbar-dark bg-primary"> 
            <span class="navbar-brand mb-0 h1">M-Turk Survey Manager</span>
            <button class="navbar-toggler" type="button" data-toggle="collapse" 
                    data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" 
                    aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-item nav-link" href="index.html">Manage</a>
                    <a class="nav-item nav-link active" href="create.html">Create</a>
                    <a class="nav-item nav-link" href="#">Account</a>
                </div>
            </div>
        </nav>
        <div class="mx-3 mt-2">
            <div class="mt-2">
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Enter URLs</span>
                    </div>

                    <input type="text" class="form-control" name="controlURL" placeholder="Control"/>
                    <input class="form-control" type="text" name="experimentalURL" placeholder="Experimental" />
                    <div class="input-group-append">
                        <button class="btn btn-outline-success">Add</button>
                    </div>
                </div>
            </div>
            <table class="table table-hover table-bordered mt-2">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Control</th>
                        <th scope="col">Experimental</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">1</th>
                        <td>https://www.youtube.com/watch?v=Bey4XXJAqS8</td>
                        <td>https://www.youtube.com/watch?v=3AGB8uovr9c</td>
                    </tr>
                    <tr>
                        <th scope="row">2</th>
                        <td>https://www.youtube.com/watch?v=Bey4XXJAqS8</td>
                        <td>https://www.youtube.com/watch?v=3AGB8uovr9c</td>
                    </tr>
                </tbody>
            </table>
            <button id="hit-submit-btn" class="btn btn-primary">Submit Hit</button>
        </div>
        <script>
            window.$ = require("jquery");
            require("popper.js");
            require("bootstrap");

            $("#hit-submit-btn").click(function() {
                /**
                 * Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.
                 *
                 * Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
                 * with the License. A copy of the License is located at
                 *
                 * http://aws.amazon.com/apache2.0/
                 *
                 * or in the "license" file accompanying this file. This file is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES
                 * OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions
                 * and limitations under the License.
                 */
                
                var util = require('util');
                var AWS = require('aws-sdk');
                
                /**
                 * Before connecting to MTurk, set up your AWS account and IAM settings as described here:
                 * https://blog.mturk.com/how-to-use-iam-to-control-api-access-to-your-mturk-account-76fe2c2e66e2
                 *
                 * Follow AWS best practices for setting credentials from here:
                 * http://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/setting-credentials-node.html
                 */
                AWS.config.loadFromPath('app/static/config.json');
                
                fs = require('fs');
                
                /**
                 * Use the Amazon Mechanical Turk Sandbox to publish test Human Intelligence Tasks (HITs) without paying any
                 * money. Sign up for a Sandbox account at https://requestersandbox.mturk.com/ with the same credentials as
                 * your main MTurk account.
                 */
                
                var endpoint = 'https://mturk-requester-sandbox.us-east-1.amazonaws.com';
                // Uncomment this line to use in production
                // endpoint = 'https://mturk-requester.us-east-1.amazonaws.com';
                
                // Connect to sandbox
                var mturk = new AWS.MTurk({ endpoint: endpoint });
                
                // Test your ability to connect to MTurk by checking your account balance
                mturk.getAccountBalance(function (err, data) {
                    if (err) {
                        console.log(err.message);
                    } else {
                        // Sandbox balance check will always return $10,000
                        console.log('I have ' + data.AvailableBalance + ' in my account.');
                    }
                })
                
                /* 
                Publish a new HIT to the Sandbox marketplace start by reading in the HTML markup specifying your task from a seperate file (my_question.xml). To learn more about the HTML question type, see here: http://docs.aws.amazon.com/AWSMechTurk/latest/AWSMturkAPI/ApiReference_HTMLQuestionArticle.html
                */ 
                
                fs.readFile('app/static/my_question.xml', 'utf8', function (err, myQuestion) {
                    if (err) {
                        return console.log(err);
                    }
                
                    // Construct the HIT object below
                    var myHIT = {
                        Title: 'This is a new test question',
                        Description: 'Another description',
                        MaxAssignments: 1,
                        LifetimeInSeconds: 3600,
                        AssignmentDurationInSeconds: 600,
                        Reward: '0.20',
                        Question: myQuestion,
                
                        // Add a qualification requirement that the Worker must be either in Canada or the US 
                        QualificationRequirements: [
                            {
                                QualificationTypeId: '00000000000000000071',
                                Comparator: 'In',
                                LocaleValues: [
                                    { Country: 'US' },
                                    { Country: 'CA' },
                                ],
                            },
                        ],
                    };
                
                    // Publish the object created above
                    mturk.createHIT(myHIT, function (err, data) {
                        if (err) {
                            console.log(err.message);
                        } else {
                            console.log(data);
                            // Save the HITId printed by data.HIT.HITId and use it in the RetrieveAndApproveResults.js code sample
                            console.log('HIT has been successfully published here: https://workersandbox.mturk.com/mturk/preview?groupId=' + data.HIT.HITTypeId + ' with this HITId: ' + data.HIT.HITId);
                        }
                    })
                });

            });
        </script>
    </body>
</html>
